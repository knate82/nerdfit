<link rel="import" href="../../../bower_components/polymer/polymer-element.html">

<dom-module id="nf-account">
    <template>
        <style>
            :host {
                align-self: center;
            }
            iron-form {
                margin: 0;
                padding: 1.5em;
                display: flex;
                flex-direction: column;
                justify-content: space-around;
            }
            paper-dialog {
                min-width: 300px;
                max-width: 400px;
                border-radius: 15px;
            }
            paper-dialog paper-button {
                align-self: flex-end;
                background-color: var(--blue);
                color: var(--white);
            }
            #profile {
                width: 8em;
                flex-direction: column;
                justify-content: center;
            }
            #profile-image {
                display: flex;
                justify-content: flex-end;
            }
            #profile:hover .profile-links {
                display: flex;
            }
            .profile-links {
                background-color: var(--white);
                display: none;
                flex-direction: column;
            }
            .profile-links ul {
                width: 100%;
                padding: 0;
                margin: 0;
            }
            .profile-links ul li {
                list-style: none;
                width: 100%;
                text-align: center;
            }
            .profile-links li:hover {
                background-color: var(--gray);
                color: var(--white);
            }
            .buttons {
                display: flex;
            }
        </style>
        <firebase-auth id="auth" app-name="nerdfit" user="{{user}}" on-error="handleError" signed-in="{{signedIn}}"></firebase-auth>
        <firebase-document
                id="query"
                app-name="nerdfit"
                path="/users/[[user.uid]]"
                data="{{userData}}">
        </firebase-document>
        <section id="login" selected="[[page]]" hidden="{{signedIn}}">
            <paper-button on-tap='toggleLoginForm'>Login</paper-button>

            <paper-dialog id="form" entry-animation="scale-up-animation" exit-animation="fade-out-animation" with-backdrop>
                <iron-form id="loginForm" on-iron-form-presubmit="formPreSubmit">
                    <form>
                        <paper-input id="loginEmail" error-message="Invalid Email Address" label="Email" type="email" min-length="5"></paper-input>
                        <paper-input id="loginPassword" label="Password" type="password"></paper-input>
                        <div class="buttons">
                            <paper-button on-tap="submitLogin" raised >Login</paper-button>
                            <paper-button on-tap="newUser">Sign Up</paper-button>
                        </div>
                    </form>
                </iron-form>
            </paper-dialog>
            <paper-dialog id="signupForm" entry-animation="scale-up-animation" exit-animation="fade-out-animation" with-backdrop>
                <iron-form id="signupForm" on-iron-form-presubmit="formPreSubmit">
                    <form>
                        <paper-input id="firstName" label="First Name" type="text" required></paper-input>
                        <paper-input id="lastName" label="Last Name" type="text" required></paper-input>
                        <paper-input id="userName" label="User Name" type="text" required></paper-input>
                        <paper-input id="email" label="Email" type="email" min-length="5" required></paper-input>
                        <paper-input id="password" label="Password" type="password" min-length="8" required></paper-input>
                        <div class="buttons">
                            <paper-button on-tap="submitSignup" raised>Submit</paper-button>
                            <paper-button on-tap="cancelSignup">Cancel</paper-button>
                        </div>
                    </form>
                </iron-form>
            </paper-dialog>
        </section>
        <section id="profile" selected="[[page]]" hidden="{{!signedIn}}">
            <div id="profile-image">
                <iron-image style="width:50px; height:50px;" sizing="contain" src="src/assets/images/nf-no-profile.jpg"></iron-image>
            </div>
            <div class="profile-links">
                <ul>
                    <li><paper-button on-tap="toggleProfileForm">Edit Profile</paper-button></li>
                    <li><paper-button on-tap="logoutUser">Friends</paper-button></li>
                    <li><paper-button on-tap="logoutUser">Logout</paper-button></li>
                </ul>
            </div>
            <paper-dialog id="profileEdit" entry-animation="scale-up-animation" exit-animation="fade-out-animation" with-backdrop>
                <iron-form id="editProfileForm" on-iron-form-presubmit="formPreSubmit">
                    <form>
                        <paper-input id="user.firstName" error-message="First name is required" label="First Name" type="text" min-length="2" required></paper-input>
                        <paper-input id="user.lastName" error-message="Last name is required" label="Last Name" type="text" min-length="2" required></paper-input>
                        <paper-input id="userName" label="User Name" min-length="5"></paper-input>
                        <paper-button on-tap="submitProfileEdit" raised >Submit</paper-button>
                    </form>
                </iron-form>
            </paper-dialog>
        </section>
    </template>
    <script>
        /**
         * @customElement
         * @polymer
         */
        class NfAccount extends Polymer.Element {
            static get is() { return 'nf-account'; }
            static get properties() {
                return {
                    signedIn: {
                        type: Boolean,
                        notify: true
                    },
                    userData: {
                        type: Object,
                        observer: "_userDataChanged",
                        notify: true
                    },
                    signUp: {
                        type: Boolean,
                        notify: true
                    }
                }
            }
            toggleLoginForm() {
                this.$.form.toggle();
            }
            toggleProfileForm() {
                this.$.profileEdit.toggle();
            }
            changePage(status) {
                switch (status) {
                    case 'login':
                        this.page = 'dashboard';
                        break;
                    case 'logout':
                        this.page = 'home';
                        break;
                    default:
                        this.page = this.$.page;
                        break;
                }
            }
            submitLogin() {
                var email = this.$.loginEmail.value;
                var password = this.$.loginPassword.value;
                var cb = this.changePage;
                if(email && password) {
                    console.log('email: ' + email + ' password: ' + password);
                    this.$.auth.signInWithEmailAndPassword(email, password)
                        .then(function(response, cbfunct = cb) {
                            var status = 'login';
                            cbfunct(status).apply(this);
                        })
                        .catch(function(error){
                            console.log(error);
                        });
                } else {
                    switch(email, password) {
                        case !email:
                            alert('Must add email to proceed.');
                            break;
                        case !password:
                            alert('Must add password to proceed.');
                            break;
                        case !email && !password:
                            alert('Valid email and password are required to proceed.');
                            break;
                        default:
                            alert('There was an issue with your submission. Please try again.');
                            break;
                    }
                }
            }
            submitSignup() {

            }
            newUser() {
                this.$.form.toggle();
                this.$.signupForm.toggle();
            }
            cancelSignup() {
                this.$.signupForm.toggle();
            }
            logoutUser() {
                this.$.auth.signOut();
                this.page = 'home';
            }
            _userDataChanged(newValue, oldValue) {
                console.log(newValue);
                console.log(this.userData.profile.userName);
            }
        }

        window.customElements.define(NfAccount.is, NfAccount);

    </script>
</dom-module>